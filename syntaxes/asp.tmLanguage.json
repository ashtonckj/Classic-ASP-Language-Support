{
    "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
    "name": "Classic ASP",
    "scopeName": "text.html.asp",
    "patterns": [
        {
            "include": "#asp-code-block"
        },
        {
            "include": "#asp-output-block"
        },
        {
            "include": "text.html.basic"
        }
    ],
    "repository": {
        "asp-code-block": {
            "name": "meta.embedded.block.asp",
            "begin": "(<%(?!=))",
            "end": "(%>)",
            "beginCaptures": {
                "1": {
                    "name": "punctuation.definition.tag.begin.asp"
                }
            },
            "endCaptures": {
                "1": {
                    "name": "punctuation.definition.tag.end.asp"
                }
            },
            "patterns": [
                {
                    "include": "#vbscript-code"
                }
            ]
        },
        "asp-output-block": {
            "name": "meta.embedded.expression.asp",
            "begin": "(<%=)",
            "end": "(%>)",
            "beginCaptures": {
                "1": {
                    "name": "punctuation.definition.tag.begin.asp"
                }
            },
            "endCaptures": {
                "1": {
                    "name": "punctuation.definition.tag.end.asp"
                }
            },
            "patterns": [
                {
                    "include": "#vbscript-code"
                }
            ]
        },
        "vbscript-code": {
            "patterns": [
                {
                    "include": "#comments"
                },
                {
                    "include": "#strings"
                },
                {
                    "include": "#keywords"
                },
                {
                    "include": "#asp-objects"
                },
                {
                    "include": "#operators"
                },
                {
                    "include": "#numbers"
                },
                {
                    "include": "#functions"
                }
            ]
        },
        "comments": {
            "patterns": [
                {
                    "name": "comment.line.apostrophe.vbscript",
                    "match": "'.*$"
                },
                {
                    "name": "comment.block.asp",
                    "begin": "<%--",
                    "end": "--%>"
                }
            ]
        },
        "strings": {
            "patterns": [
                {
                    "comment": "SQL strings - detect by SQL keywords anywhere in string",
                    "name": "string.quoted.double.sql.vbscript",
                    "begin": "\"(?=.*(?i)\\b(SELECT|INSERT|UPDATE|DELETE|CREATE|DROP|ALTER|FROM|WHERE|AND|OR|AS|ON|JOIN|LEFT|RIGHT|INNER|OUTER|FULL|CROSS|ORDER BY|GROUP BY|UNION|WITH|HAVING|IS NULL|IS NOT NULL|SET|VALUES|INTO|LIMIT|OFFSET|DISTINCT|TOP)\\b)",
                    "end": "\"",
                    "beginCaptures": {
                        "0": {
                            "name": "punctuation.definition.string.begin.vbscript"
                        }
                    },
                    "endCaptures": {
                        "0": {
                            "name": "punctuation.definition.string.end.vbscript"
                        }
                    },
                    "patterns": [
                        {
                            "include": "#sql-syntax"
                        }
                    ]
                },
                {
                    "comment": "SQL strings - detect by table/column patterns [schema].[table].[column]",
                    "name": "string.quoted.double.sql.vbscript",
                    "begin": "\"(?=.*\\[[^\\]]+\\]\\.\\[[^\\]]+\\])",
                    "end": "\"",
                    "beginCaptures": {
                        "0": {
                            "name": "punctuation.definition.string.begin.vbscript"
                        }
                    },
                    "endCaptures": {
                        "0": {
                            "name": "punctuation.definition.string.end.vbscript"
                        }
                    },
                    "patterns": [
                        {
                            "include": "#sql-syntax"
                        }
                    ]
                },
                {
                    "comment": "SQL strings - detect by common SQL patterns like aliases (a.Column, b.Field)",
                    "name": "string.quoted.double.sql.vbscript",
                    "begin": "\"(?=.*\\b[a-z]\\.[A-Z][a-zA-Z0-9_]*)",
                    "end": "\"",
                    "beginCaptures": {
                        "0": {
                            "name": "punctuation.definition.string.begin.vbscript"
                        }
                    },
                    "endCaptures": {
                        "0": {
                            "name": "punctuation.definition.string.end.vbscript"
                        }
                    },
                    "patterns": [
                        {
                            "include": "#sql-syntax"
                        }
                    ]
                },
                {
                    "name": "string.quoted.double.vbscript",
                    "begin": "\"",
                    "end": "\"",
                    "patterns": [
                        {
                            "name": "constant.character.escape.vbscript",
                            "match": "\"\""
                        }
                    ]
                }
            ]
        },
        "sql-syntax": {
            "patterns": [
                {
                    "name": "constant.character.escape.vbscript",
                    "match": "\"\""
                },
                {
                    "comment": "Multi-word SQL phrases - must come before single keywords",
                    "name": "storage.modifier.sql",
                    "match": "\\b(?i)(IS\\s+NOT\\s+NULL|IS\\s+NULL|NOT\\s+NULL|ORDER\\s+BY|GROUP\\s+BY|UNION\\s+ALL|LEFT\\s+JOIN|RIGHT\\s+JOIN|INNER\\s+JOIN|OUTER\\s+JOIN|FULL\\s+JOIN|CROSS\\s+JOIN|LEFT\\s+OUTER\\s+JOIN|RIGHT\\s+OUTER\\s+JOIN)\\b"
                },
                {
                    "comment": "SQL DML commands",
                    "name": "keyword.other.DML.sql",
                    "match": "\\b(?i)(SELECT|INSERT|UPDATE|DELETE|FROM|WHERE|JOIN|ON|HAVING|DISTINCT|TOP|LIMIT|OFFSET)\\b"
                },
                {
                    "comment": "SQL DDL commands",
                    "name": "keyword.other.DDL.sql",
                    "match": "\\b(?i)(CREATE|DROP|ALTER|TABLE|INDEX|VIEW|DATABASE|PROCEDURE|TRIGGER|SCHEMA)\\b"
                },
                {
                    "comment": "SQL logical operators",
                    "name": "keyword.operator.logical.sql",
                    "match": "\\b(?i)(AND|OR|NOT|IN|LIKE|BETWEEN|EXISTS)\\b"
                },
                {
                    "comment": "SQL comparison operators",
                    "name": "keyword.operator.comparison.sql",
                    "match": "(<>|!=|<=|>=|<|>|=)"
                },
                {
                    "comment": "SQL keywords",
                    "name": "keyword.other.sql",
                    "match": "\\b(?i)(AS|ASC|DESC|SET|VALUES|INTO|CASE|WHEN|THEN|ELSE|END|WITH|NOLOCK|DEFAULT|CONSTRAINT|PRIMARY|FOREIGN|KEY|UNIQUE|REFERENCES|CHECK|COLLATE)\\b"
                },
                {
                    "comment": "SQL aggregate and window functions",
                    "name": "support.function.aggregate.sql",
                    "match": "\\b(?i)(COUNT|SUM|AVG|MAX|MIN|ROW_NUMBER|RANK|DENSE_RANK|PARTITION|OVER)\\b"
                },
                {
                    "comment": "SQL string functions",
                    "name": "support.function.string.sql",
                    "match": "\\b(?i)(SUBSTRING|LEN|LENGTH|UPPER|LOWER|TRIM|LTRIM|RTRIM|CONCAT|CONCAT_WS|REPLACE|CHARINDEX|PATINDEX|STUFF|LEFT|RIGHT|REVERSE|REPLICATE|SPACE)\\b"
                },
                {
                    "comment": "SQL date/time functions",
                    "name": "support.function.datetime.sql",
                    "match": "\\b(?i)(GETDATE|GETUTCDATE|DATEADD|DATEDIFF|DATEPART|DATENAME|YEAR|MONTH|DAY|HOUR|MINUTE|SECOND|DAYOFWEEK|DAYOFYEAR|WEEK|QUARTER|CONVERT|CAST|FORMAT)\\b"
                },
                {
                    "comment": "SQL mathematical functions",
                    "name": "support.function.math.sql",
                    "match": "\\b(?i)(ABS|CEILING|FLOOR|ROUND|POWER|SQRT|EXP|LOG|LOG10|SIN|COS|TAN|SIGN|RAND)\\b"
                },
                {
                    "comment": "SQL NULL-handling functions",
                    "name": "support.function.null.sql",
                    "match": "\\b(?i)(ISNULL|COALESCE|NULLIF|IFNULL)\\b"
                },
                {
                    "comment": "SQL conditional functions",
                    "name": "support.function.conditional.sql",
                    "match": "\\b(?i)(IIF|CHOOSE)\\b"
                },
                {
                    "comment": "NULL constant - special highlighting",
                    "name": "constant.language.null.sql",
                    "match": "\\b(?i)NULL\\b"
                },
                {
                    "comment": "SQL data types",
                    "name": "storage.type.sql",
                    "match": "\\b(?i)(VARCHAR|NVARCHAR|CHAR|NCHAR|TEXT|NTEXT|INT|INTEGER|BIGINT|SMALLINT|TINYINT|DECIMAL|NUMERIC|FLOAT|REAL|MONEY|SMALLMONEY|BIT|DATE|DATETIME|DATETIME2|SMALLDATETIME|TIME|TIMESTAMP|UNIQUEIDENTIFIER|XML|VARBINARY|BINARY|IMAGE)\\b"
                },
                {
                    "comment": "SQL boolean literals",
                    "name": "constant.language.boolean.sql",
                    "match": "\\b(?i)(TRUE|FALSE)\\b"
                },
                {
                    "comment": "SQL numeric literals",
                    "name": "constant.numeric.sql",
                    "match": "\\b\\d+(\\.\\d+)?([eE][+-]?\\d+)?\\b"
                },
                {
                    "comment": "SQL wildcard",
                    "name": "keyword.operator.wildcard.sql",
                    "match": "\\*"
                },
                {
                    "comment": "SQL parameter/variable prefix",
                    "name": "variable.parameter.sql",
                    "match": "@[a-zA-Z_][a-zA-Z0-9_]*"
                }
            ]
        },
        "keywords": {
            "patterns": [
                {
                    "name": "keyword.control.vbscript",
                    "match": "\\b(?i)(if|then|else|elseif|end\\s+if|select|case|end\\s+select|for|to|each|in|step|next|while|wend|do|loop|until|exit|goto)\\b"
                },
                {
                    "name": "keyword.other.vbscript",
                    "match": "\\b(?i)(dim|redim|const|private|public|sub|end\\s+sub|function|end\\s+function|property|get|let|set|end\\s+property|class|end\\s+class|new|with|end\\s+with|option|explicit|call|on|error|resume)\\b"
                },
                {
                    "name": "keyword.operator.logical.vbscript",
                    "match": "\\b(?i)(and|or|not|xor|eqv|imp)\\b"
                },
                {
                    "name": "constant.language.vbscript",
                    "match": "\\b(?i)(true|false|null|nothing|empty)\\b"
                }
            ]
        },
        "asp-objects": {
            "patterns": [
                {
                    "name": "support.class.asp",
                    "match": "\\b(?i)(Response|Request|Server|Session|Application)\\b"
                },
                {
                    "name": "support.function.asp",
                    "match": "\\b(?i)(Write|Redirect|End|CreateObject|MapPath|HTMLEncode|URLEncode)\\b"
                },
                {
                    "name": "support.variable.asp",
                    "match": "\\b(?i)(Form|QueryString|ServerVariables|Cookies)\\b"
                }
            ]
        },
        "operators": {
            "patterns": [
                {
                    "name": "keyword.operator.comparison.vbscript",
                    "match": "(<>|<=|>=|<|>|=)"
                },
                {
                    "name": "keyword.operator.arithmetic.vbscript",
                    "match": "(\\+|-|\\*|/|\\\\|mod|\\^)"
                },
                {
                    "name": "keyword.operator.concatenation.vbscript",
                    "match": "&"
                },
                {
                    "name": "keyword.operator.vbscript",
                    "match": "\\b(?i)is\\b"
                }
            ]
        },
        "numbers": {
            "patterns": [
                {
                    "name": "constant.numeric.vbscript",
                    "match": "\\b\\d+(\\.\\d+)?\\b"
                }
            ]
        },
        "functions": {
            "patterns": [
                {
                    "name": "support.function.vbscript",
                    "match": "\\b(?i)(Abs|Array|Asc|Atn|CBool|CByte|CCur|CDate|CDbl|Chr|CInt|CLng|Cos|CreateObject|CSng|CStr|Date|DateAdd|DateDiff|DatePart|DateSerial|DateValue|Day|Exp|Filter|Fix|FormatCurrency|FormatDateTime|FormatNumber|FormatPercent|GetObject|Hex|Hour|InputBox|InStr|InStrRev|Int|IsArray|IsDate|IsEmpty|IsNull|IsNumeric|IsObject|Join|LBound|LCase|Left|Len|LoadPicture|Log|LTrim|Mid|Minute|Month|MonthName|MsgBox|Now|Oct|Replace|RGB|Right|Rnd|Round|RTrim|ScriptEngine|ScriptEngineBuildVersion|ScriptEngineMajorVersion|ScriptEngineMinorVersion|Second|Sgn|Sin|Space|Split|Sqr|StrComp|String|StrReverse|Tan|Time|Timer|TimeSerial|TimeValue|Trim|TypeName|UBound|UCase|VarType|Weekday|WeekdayName|Year)\\b"
                }
            ]
        }
    }
}